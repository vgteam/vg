<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vg: vg::HTSWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vg
   </div>
   <div id="projectbrief">tools for working with variation graphs</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacevg.html">vg</a></li><li class="navelem"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pro-static-attribs">Static Protected Attributes</a> &#124;
<a href="classvg_1_1HTSWriter-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">vg::HTSWriter Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;hts_alignment_emitter.hpp&gt;</code></p>
<div class="dynheader">
Inheritance diagram for vg::HTSWriter:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classvg_1_1HTSWriter.png" usemap="#vg::HTSWriter_map" alt=""/>
  <map id="vg::HTSWriter_map" name="vg::HTSWriter_map">
<area href="classvg_1_1HTSAlignmentEmitter.html" alt="vg::HTSAlignmentEmitter" shape="rect" coords="0,56,191,80"/>
<area href="classvg_1_1MultipathAlignmentEmitter.html" alt="vg::MultipathAlignmentEmitter" shape="rect" coords="201,56,392,80"/>
<area href="classvg_1_1SplicedHTSAlignmentEmitter.html" alt="vg::SplicedHTSAlignmentEmitter" shape="rect" coords="0,112,191,136"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3797ff445359e9052869f9191310fe54"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a3797ff445359e9052869f9191310fe54">HTSWriter</a> (const string &amp;filename, const string &amp;<a class="el" href="classvg_1_1HTSWriter.html#a4c549b347cd3dba4710e1a195445a8b0">format</a>, const <a class="el" href="namespacevg.html#a1ff0e710c53111ed4cd2a7389df9c945">SequenceDictionary</a> &amp;<a class="el" href="classvg_1_1HTSWriter.html#aa8b10018f815be414e59bafe13cc2528">sequence_dictionary</a>, const unordered_map&lt; string, size_t &gt; &amp;<a class="el" href="classvg_1_1HTSWriter.html#a4aba698bf7c64bb42342b5461614dc32">subpath_to_index</a>, size_t max_threads)</td></tr>
<tr class="separator:a3797ff445359e9052869f9191310fe54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8be4096c91ac54b168828071b814104d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a8be4096c91ac54b168828071b814104d">~HTSWriter</a> ()</td></tr>
<tr class="memdesc:a8be4096c91ac54b168828071b814104d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tear down an <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> and destroy HTSlib structures.  <a href="classvg_1_1HTSWriter.html#a8be4096c91ac54b168828071b814104d">More...</a><br /></td></tr>
<tr class="separator:a8be4096c91ac54b168828071b814104d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2fc6b2a60e3bc9441956faf87ff6a07"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#ae2fc6b2a60e3bc9441956faf87ff6a07">HTSWriter</a> (const <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;other)=delete</td></tr>
<tr class="separator:ae2fc6b2a60e3bc9441956faf87ff6a07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa299cc70e86ed6fe1dd1eefef0a23f5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#aaa299cc70e86ed6fe1dd1eefef0a23f5">operator=</a> (const <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;other)=delete</td></tr>
<tr class="separator:aaa299cc70e86ed6fe1dd1eefef0a23f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a23221d8449a4b4e0b1278995ad0207"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a0a23221d8449a4b4e0b1278995ad0207">HTSWriter</a> (<a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&amp;other)=delete</td></tr>
<tr class="separator:a0a23221d8449a4b4e0b1278995ad0207"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec4df6ab5d9c7d4b1557e9cb04ef30d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a2ec4df6ab5d9c7d4b1557e9cb04ef30d">operator=</a> (<a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&amp;other)=delete</td></tr>
<tr class="separator:a2ec4df6ab5d9c7d4b1557e9cb04ef30d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a4d3f2772a76d36733f1bb1ccf93f498b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a4d3f2772a76d36733f1bb1ccf93f498b">save_records</a> (bam_hdr_t *header, vector&lt; bam1_t * &gt; &amp;records, size_t thread_number)</td></tr>
<tr class="separator:a4d3f2772a76d36733f1bb1ccf93f498b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eff59af09a0169f3da8510b8359b098"><td class="memItemLeft" align="right" valign="top">bam_hdr_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a5eff59af09a0169f3da8510b8359b098">ensure_header</a> (const string &amp;read_group, const string &amp;sample_name, size_t thread_number)</td></tr>
<tr class="separator:a5eff59af09a0169f3da8510b8359b098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3063999c0e6b467c7717edfb53040166"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a3063999c0e6b467c7717edfb53040166">initialize_sam_file</a> (bam_hdr_t *header, size_t thread_number, bool keep_header=false)</td></tr>
<tr class="separator:a3063999c0e6b467c7717edfb53040166"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:aff12605f14901844666bf6775b7c0971"><td class="memItemLeft" align="right" valign="top">unique_ptr&lt; ofstream &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#aff12605f14901844666bf6775b7c0971">out_file</a></td></tr>
<tr class="memdesc:aff12605f14901844666bf6775b7c0971"><td class="mdescLeft">&#160;</td><td class="mdescRight">If we are doing output to a file, this will hold the open file. Otherwise (for stdout) it will be empty.  <a href="classvg_1_1HTSWriter.html#aff12605f14901844666bf6775b7c0971">More...</a><br /></td></tr>
<tr class="separator:aff12605f14901844666bf6775b7c0971"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e2ff3f77a4265c8dcd1c47770a0bee5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classvg_1_1io_1_1StreamMultiplexer.html">vg::io::StreamMultiplexer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a6e2ff3f77a4265c8dcd1c47770a0bee5">multiplexer</a></td></tr>
<tr class="separator:a6e2ff3f77a4265c8dcd1c47770a0bee5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c549b347cd3dba4710e1a195445a8b0"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a4c549b347cd3dba4710e1a195445a8b0">format</a></td></tr>
<tr class="separator:a4c549b347cd3dba4710e1a195445a8b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8b10018f815be414e59bafe13cc2528"><td class="memItemLeft" align="right" valign="top"><a class="el" href="namespacevg.html#a1ff0e710c53111ed4cd2a7389df9c945">SequenceDictionary</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#aa8b10018f815be414e59bafe13cc2528">sequence_dictionary</a></td></tr>
<tr class="separator:aa8b10018f815be414e59bafe13cc2528"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4aba698bf7c64bb42342b5461614dc32"><td class="memItemLeft" align="right" valign="top">unordered_map&lt; string, size_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a4aba698bf7c64bb42342b5461614dc32">subpath_to_index</a></td></tr>
<tr class="memdesc:a4aba698bf7c64bb42342b5461614dc32"><td class="mdescLeft">&#160;</td><td class="mdescRight">This maps from subpath to entry number in the sequence dictionary.  <a href="classvg_1_1HTSWriter.html#a4aba698bf7c64bb42342b5461614dc32">More...</a><br /></td></tr>
<tr class="separator:a4aba698bf7c64bb42342b5461614dc32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6b1fd5c6e6dc4f91601f115bd1e7410"><td class="memItemLeft" align="right" valign="top">vector&lt; hFILE * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#ad6b1fd5c6e6dc4f91601f115bd1e7410">backing_files</a></td></tr>
<tr class="separator:ad6b1fd5c6e6dc4f91601f115bd1e7410"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57a7f16757fc6ce944636d69c48903cb"><td class="memItemLeft" align="right" valign="top">vector&lt; samFile * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a57a7f16757fc6ce944636d69c48903cb">sam_files</a></td></tr>
<tr class="separator:a57a7f16757fc6ce944636d69c48903cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8446e15c0caf781e6a9d26cffaf82da"><td class="memItemLeft" align="right" valign="top">atomic&lt; bam_hdr_t * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#ab8446e15c0caf781e6a9d26cffaf82da">atomic_header</a></td></tr>
<tr class="memdesc:ab8446e15c0caf781e6a9d26cffaf82da"><td class="mdescLeft">&#160;</td><td class="mdescRight">We need a header.  <a href="classvg_1_1HTSWriter.html#ab8446e15c0caf781e6a9d26cffaf82da">More...</a><br /></td></tr>
<tr class="separator:ab8446e15c0caf781e6a9d26cffaf82da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95cd5874834de9191faf18d39fef9534"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a95cd5874834de9191faf18d39fef9534">sam_header</a></td></tr>
<tr class="separator:a95cd5874834de9191faf18d39fef9534"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9d539c1312350395949b75010134032"><td class="memItemLeft" align="right" valign="top">mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#af9d539c1312350395949b75010134032">header_mutex</a></td></tr>
<tr class="memdesc:af9d539c1312350395949b75010134032"><td class="mdescLeft">&#160;</td><td class="mdescRight">If the header isn't present when we want to write, we need a mutex to control creating it.  <a href="classvg_1_1HTSWriter.html#af9d539c1312350395949b75010134032">More...</a><br /></td></tr>
<tr class="separator:af9d539c1312350395949b75010134032"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a440cfc6e79f5790976ebac5e648a3696"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a440cfc6e79f5790976ebac5e648a3696">output_is_bgzf</a></td></tr>
<tr class="separator:a440cfc6e79f5790976ebac5e648a3696"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2151e3837dd1503111bf7d1daa1fa56"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#ab2151e3837dd1503111bf7d1daa1fa56">hts_mode</a></td></tr>
<tr class="memdesc:ab2151e3837dd1503111bf7d1daa1fa56"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remember the HTSlib mode string we need to open our files.  <a href="classvg_1_1HTSWriter.html#ab2151e3837dd1503111bf7d1daa1fa56">More...</a><br /></td></tr>
<tr class="separator:ab2151e3837dd1503111bf7d1daa1fa56"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-static-attribs"></a>
Static Protected Attributes</h2></td></tr>
<tr class="memitem:a00ebb72aacf4587e3d95a3a359da3323"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a00ebb72aacf4587e3d95a3a359da3323">BGZF_FOOTER_LENGTH</a> = 28</td></tr>
<tr class="memdesc:a00ebb72aacf4587e3d95a3a359da3323"><td class="mdescLeft">&#160;</td><td class="mdescRight">We hack about with htslib's BGZF EOF footers, so we need to know how long they are.  <a href="classvg_1_1HTSWriter.html#a00ebb72aacf4587e3d95a3a359da3323">More...</a><br /></td></tr>
<tr class="separator:a00ebb72aacf4587e3d95a3a359da3323"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bf83c8f66a03323fffd5feb95e8ec15"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvg_1_1HTSWriter.html#a0bf83c8f66a03323fffd5feb95e8ec15">HTSLIB_CRAM_THREADS</a> = 8</td></tr>
<tr class="memdesc:a0bf83c8f66a03323fffd5feb95e8ec15"><td class="mdescLeft">&#160;</td><td class="mdescRight">For CRAM output, we use a separate pool of compressor threads inside htslib.  <a href="classvg_1_1HTSWriter.html#a0bf83c8f66a03323fffd5feb95e8ec15">More...</a><br /></td></tr>
<tr class="separator:a0bf83c8f66a03323fffd5feb95e8ec15"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3797ff445359e9052869f9191310fe54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3797ff445359e9052869f9191310fe54">&#9670;&nbsp;</a></span>HTSWriter() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vg::HTSWriter::HTSWriter </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="namespacevg.html#a1ff0e710c53111ed4cd2a7389df9c945">SequenceDictionary</a> &amp;&#160;</td>
          <td class="paramname"><em>sequence_dictionary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unordered_map&lt; string, size_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>subpath_to_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_threads</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create an <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> writing to the given file (or "-") in the given HTS format ("SAM", "BAM", "CRAM"). Sample names and read groups for the header will be guessed from the first reads. HTSlib positions will be read from the alignments' refpos, and the alignments must be surjected. </p>

</div>
</div>
<a id="a8be4096c91ac54b168828071b814104d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8be4096c91ac54b168828071b814104d">&#9670;&nbsp;</a></span>~HTSWriter()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">vg::HTSWriter::~HTSWriter </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tear down an <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> and destroy HTSlib structures. </p>

</div>
</div>
<a id="ae2fc6b2a60e3bc9441956faf87ff6a07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2fc6b2a60e3bc9441956faf87ff6a07">&#9670;&nbsp;</a></span>HTSWriter() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vg::HTSWriter::HTSWriter </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a0a23221d8449a4b4e0b1278995ad0207"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a23221d8449a4b4e0b1278995ad0207">&#9670;&nbsp;</a></span>HTSWriter() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vg::HTSWriter::HTSWriter </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a5eff59af09a0169f3da8510b8359b098"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5eff59af09a0169f3da8510b8359b098">&#9670;&nbsp;</a></span>ensure_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bam_hdr_t * vg::HTSWriter::ensure_header </td>
          <td>(</td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>read_group</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const string &amp;&#160;</td>
          <td class="paramname"><em>sample_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>thread_number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Make sure that the HTS header has been written, and the samFile* in sam_files has been created for the given thread.</p>
<p>If the header has not been written, blocks until it has been written.</p>
<p>If we end up being the thread to write it, sniff header information from the given alignment.</p>
<p>Returns the header pointer, so we don't have to do another atomic read later. </p>

</div>
</div>
<a id="a3063999c0e6b467c7717edfb53040166"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3063999c0e6b467c7717edfb53040166">&#9670;&nbsp;</a></span>initialize_sam_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vg::HTSWriter::initialize_sam_file </td>
          <td>(</td>
          <td class="paramtype">bam_hdr_t *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>thread_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>keep_header</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Given a header and a thread number, make sure the samFile* for that thread is initialized and ready to have alignments written to it. If true, actually writes the given header into the output file created by the multiplexer. If the samFile* was already initialized, flushes it out and makes a breakpoint. </p>

</div>
</div>
<a id="aaa299cc70e86ed6fe1dd1eefef0a23f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa299cc70e86ed6fe1dd1eefef0a23f5">&#9670;&nbsp;</a></span>operator=() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a>&amp; vg::HTSWriter::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a2ec4df6ab5d9c7d4b1557e9cb04ef30d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec4df6ab5d9c7d4b1557e9cb04ef30d">&#9670;&nbsp;</a></span>operator=() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a>&amp; vg::HTSWriter::operator= </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvg_1_1HTSWriter.html">HTSWriter</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>other</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">delete</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a4d3f2772a76d36733f1bb1ccf93f498b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d3f2772a76d36733f1bb1ccf93f498b">&#9670;&nbsp;</a></span>save_records()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void vg::HTSWriter::save_records </td>
          <td>(</td>
          <td class="paramtype">bam_hdr_t *&#160;</td>
          <td class="paramname"><em>header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vector&lt; bam1_t * &gt; &amp;&#160;</td>
          <td class="paramname"><em>records</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>thread_number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Write and deallocate a bunch of BAM records. Takes care of locking the file. Header must have been written already. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ab8446e15c0caf781e6a9d26cffaf82da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8446e15c0caf781e6a9d26cffaf82da">&#9670;&nbsp;</a></span>atomic_header</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">atomic&lt;bam_hdr_t*&gt; vg::HTSWriter::atomic_header</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>We need a header. </p>

</div>
</div>
<a id="ad6b1fd5c6e6dc4f91601f115bd1e7410"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6b1fd5c6e6dc4f91601f115bd1e7410">&#9670;&nbsp;</a></span>backing_files</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;hFILE*&gt; vg::HTSWriter::backing_files</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>To back our samFile*s, we need the hFILE* objects wrapping our C++ streams. We need to manually flush these after HTS headers are written, since bgzf_flush, which samtools calls, closes a BGZF block and sends the data to the hFILE* but does not actually flush the hFILE*. These will be pointers to the hFILE* for each thread's samFile*. We may only use them while the samFile* they belong to is still open; closing the samFile* will free the hFILE* but not null it out of this vector. </p>

</div>
</div>
<a id="a00ebb72aacf4587e3d95a3a359da3323"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00ebb72aacf4587e3d95a3a359da3323">&#9670;&nbsp;</a></span>BGZF_FOOTER_LENGTH</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t vg::HTSWriter::BGZF_FOOTER_LENGTH = 28</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>We hack about with htslib's BGZF EOF footers, so we need to know how long they are. </p>

</div>
</div>
<a id="a4c549b347cd3dba4710e1a195445a8b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c549b347cd3dba4710e1a195445a8b0">&#9670;&nbsp;</a></span>format</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string vg::HTSWriter::format</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This holds our format name, for later error messages. We also use it to decide if we're in magic serialized-writes CRAM mode, where we use only one samFile* and one hFILE* and a one-thread multiplexer that doesn't really multiplex. </p>

</div>
</div>
<a id="af9d539c1312350395949b75010134032"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9d539c1312350395949b75010134032">&#9670;&nbsp;</a></span>header_mutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">mutex vg::HTSWriter::header_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If the header isn't present when we want to write, we need a mutex to control creating it. </p>

</div>
</div>
<a id="ab2151e3837dd1503111bf7d1daa1fa56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2151e3837dd1503111bf7d1daa1fa56">&#9670;&nbsp;</a></span>hts_mode</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string vg::HTSWriter::hts_mode</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remember the HTSlib mode string we need to open our files. </p>

</div>
</div>
<a id="a0bf83c8f66a03323fffd5feb95e8ec15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bf83c8f66a03323fffd5feb95e8ec15">&#9670;&nbsp;</a></span>HTSLIB_CRAM_THREADS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t vg::HTSWriter::HTSLIB_CRAM_THREADS = 8</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>For CRAM output, we use a separate pool of compressor threads inside htslib. </p>

</div>
</div>
<a id="a6e2ff3f77a4265c8dcd1c47770a0bee5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e2ff3f77a4265c8dcd1c47770a0bee5">&#9670;&nbsp;</a></span>multiplexer</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvg_1_1io_1_1StreamMultiplexer.html">vg::io::StreamMultiplexer</a> vg::HTSWriter::multiplexer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This holds a StreamMultiplexer on the output stream, for sharing it between threads. </p>

</div>
</div>
<a id="aff12605f14901844666bf6775b7c0971"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff12605f14901844666bf6775b7c0971">&#9670;&nbsp;</a></span>out_file</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unique_ptr&lt;ofstream&gt; vg::HTSWriter::out_file</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If we are doing output to a file, this will hold the open file. Otherwise (for stdout) it will be empty. </p>

</div>
</div>
<a id="a440cfc6e79f5790976ebac5e648a3696"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a440cfc6e79f5790976ebac5e648a3696">&#9670;&nbsp;</a></span>output_is_bgzf</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool vg::HTSWriter::output_is_bgzf</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Remember if we are outputting BGZF-compressed data or not. If we are, we trim off spurious EOF markers and append our own. </p>

</div>
</div>
<a id="a57a7f16757fc6ce944636d69c48903cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a57a7f16757fc6ce944636d69c48903cb">&#9670;&nbsp;</a></span>sam_files</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">vector&lt;samFile*&gt; vg::HTSWriter::sam_files</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We make one samFile* per thread, on each thread's output stream form the multiplexer. As soon as we create them, we show them the header, so they are initialized properly. If they have not yet been filled in (because the header is not ready yet), they are null. </p>

</div>
</div>
<a id="a95cd5874834de9191faf18d39fef9534"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95cd5874834de9191faf18d39fef9534">&#9670;&nbsp;</a></span>sam_header</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string vg::HTSWriter::sam_header</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>We also need a header string. Not atomic, because by the time we read it we know the header is ready and nobody is writing to it. </p>

</div>
</div>
<a id="aa8b10018f815be414e59bafe13cc2528"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8b10018f815be414e59bafe13cc2528">&#9670;&nbsp;</a></span>sequence_dictionary</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="namespacevg.html#a1ff0e710c53111ed4cd2a7389df9c945">SequenceDictionary</a> vg::HTSWriter::sequence_dictionary</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Store the path names and lengths in the order to put them in the header. TODO: Can we use a reference here and save a copy? </p>

</div>
</div>
<a id="a4aba698bf7c64bb42342b5461614dc32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4aba698bf7c64bb42342b5461614dc32">&#9670;&nbsp;</a></span>subpath_to_index</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unordered_map&lt;string, size_t&gt; vg::HTSWriter::subpath_to_index</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This maps from subpath to entry number in the sequence dictionary. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/<a class="el" href="hts__alignment__emitter_8hpp.html">hts_alignment_emitter.hpp</a></li>
<li>src/<a class="el" href="hts__alignment__emitter_8cpp.html">hts_alignment_emitter.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
